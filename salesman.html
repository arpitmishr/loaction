<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Salesman Dashboard</title>

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<div id="loader">Loading...</div>

<div id="content" style="display:none;">

  <!-- NAVBAR -->
  <nav>
    <h1>Sales App</h1>
    <div>
      <button onclick="switchView('route')">Route</button>
      <button onclick="switchView('catalog')">Catalog</button>
      <button id="logoutBtn" style="background:#dc3545;">Logout</button>
    </div>
  </nav>

  <div class="container">

    <!-- ================= ROUTE VIEW ================= -->
    <div id="route-view">

      <div class="card">
        <h3>üìç My Route Today</h3>
        <h2 id="route-name">Loading...</h2>
      </div>

      <div class="card">
        <h3>üè¨ Shops to Visit</h3>
        <ul id="shops-list">
          <li>Loading...</li>
        </ul>
      </div>

    </div>

    <!-- ================= CATALOG VIEW ================= -->
    <div id="catalog-view" style="display:none;">

      <div class="card">
        <h3>üìã Product Catalog</h3>

        <input
          type="text"
          id="searchProd"
          placeholder="üîç Search products..."
          style="width:100%; padding:10px; margin-bottom:15px;"
        />

        <div
          id="catalog-list"
          style="display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:10px;"
        ></div>
      </div>

    </div>


<div id="order-view" style="display: none;">
    <button onclick="cancelOrder()" style="margin-bottom:10px; background:#6c757d; color:white; border:none; padding:5px 10px; border-radius:4px;">‚¨Ö Cancel</button>
    
    <div class="card">
        <h3>üìù New Order</h3>
        <h4 id="order-outlet-name" style="color:#007bff; margin-top:0;">Outlet Name</h4>
        
        <!-- SETTINGS SECTION -->
        <div style="display: grid; gap: 10px; margin-bottom: 15px;">
            
            <!-- 1. Phone Order Toggle (Skips GPS) -->
            <div style="background:#fff3cd; padding:10px; border-radius:5px; border:1px solid #ffeeba; display:flex; align-items:center; justify-content:space-between;">
                <div>
                    <strong>üìû Phone Order?</strong><br>
                    <small style="color:#856404;">(Skip Location Check)</small>
                </div>
                <input type="checkbox" id="isPhoneOrder" style="width:20px; height:20px;">
            </div>

            <!-- 2. GST Toggle (Optional Tax) -->
            <div style="background:#e2e3e5; padding:10px; border-radius:5px; border:1px solid #d6d8db; display:flex; align-items:center; justify-content:space-between;">
                <div>
                    <strong>üíµ Apply 5% GST?</strong><br>
                    <small style="color:#383d41;">(Optional for all orders)</small>
                </div>
                <input type="checkbox" id="applyGst" style="width:20px; height:20px;">
            </div>
        </div>

        <!-- PRODUCT SELECTOR -->
        <div style="display:grid; grid-template-columns: 2fr 1fr auto; gap:5px; margin-bottom:15px;">
            <select id="order-product-select" style="padding:8px;">
                <option value="">Select Product...</option>
                <!-- JS populates this -->
            </select>
            <input type="number" id="order-qty" placeholder="Qty" min="1" style="padding:8px;">
            <button onclick="addToCart()" style="background:#28a745; color:white; border:none; border-radius:4px;">‚ûï</button>
        </div>

        <!-- CART TABLE -->
        <table style="width:100%; font-size:0.9rem; border-collapse:collapse; margin-bottom:15px;">
            <thead>
                <tr style="background:#eee; text-align:left;">
                    <th style="padding:5px;">Item</th>
                    <th>Qty</th>
                    <th>Total</th>
                    <th>‚ùå</th>
                </tr>
            </thead>
            <tbody id="order-cart-body">
                <!-- Cart items here -->
            </tbody>
        </table>

        <!-- TOTALS -->
        <div style="text-align:right; border-top:2px solid #ddd; padding-top:10px;">
            <div>Subtotal: <span id="ord-subtotal">‚Çπ0.00</span></div>
            <div id="tax-row" style="color:#d63384; display:none;">GST (5%): <span id="ord-tax">‚Çπ0.00</span></div>
            <div style="font-size:1.2rem; font-weight:bold; margin-top:5px;">Total: <span id="ord-grand-total">‚Çπ0.00</span></div>
        </div>

        <button id="btn-submit-order" onclick="submitOrder()" class="btn-primary" style="width:100%; margin-top:15px;">Confirm Order</button>
    </div>
</div>
    

    <!-- ================= VISIT VIEW ================= -->
    <div id="visit-view" style="display:none;">

      <button onclick="closeVisitPanel()" style="margin-bottom:10px;">
        ‚¨Ö Back to List
      </button>

      <div class="card">

        <h3 id="visit-shop-name">Shop Name</h3>

        <div
          id="map"
          style="height:250px; width:100%; border-radius:8px; margin:10px 0;"
        ></div>

        <div style="background:#eee; padding:10px; border-radius:5px; margin-bottom:10px;">
          <strong>Distance to Shop:</strong>
          <span id="dist-display">Calculating...</span>
        </div>

        <!-- ACTIONS -->
        <div id="visit-actions">

          <!-- CHECK IN -->
          <button
            id="btn-geo-checkin"
            class="btn-primary"
            style="width:100%;"
          >
            üìç Check In (Enter Fence)
          </button>

          <!-- IN-SHOP CONTROLS -->
          <div id="in-shop-controls" style="display:none; margin-top:15px;">
    <p style="color:green; font-weight:bold;">‚úÖ You are Checked In</p>
    
    <!-- OUTSTANDING BALANCE DISPLAY -->
    <div style="background:#f8d7da; color:#721c24; padding:10px; border-radius:5px; margin-bottom:10px; text-align:center;">
        <small>Current Outstanding:</small><br>
        <strong style="font-size:1.2rem;" id="visit-outstanding-bal">‚Çπ0.00</strong>
    </div>

    <p>Duration: <span id="visit-timer">00:00</span></p>
    
    <button id="btn-take-order" class="btn-primary" style="background: #6f42c1; width:100%; margin-bottom:10px;">üìù Take Order</button>
    
    <!-- NEW PAYMENT BUTTON -->
    <button id="btn-collect-payment" onclick="openPaymentModal()" style="background: #28a745; color: white; width:100%; padding:10px; border:none; border-radius:50px; margin-bottom:10px;">üí∞ Collect Payment</button>
    
    <button id="btn-end-visit" style="background: #dc3545; color: white; width:100%; padding:10px; border:none; border-radius:50px;">‚èπ End Visit</button>
</div>

<!-- PAYMENT MODAL (Add at the bottom of the body) -->
<div id="paymentModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:white; padding:20px; border-radius:8px; width:80%; max-width:300px;">
        <h3>üí∞ Collect Payment</h3>
        <p>From: <b id="pay-outlet-name"></b></p>
        
        <input type="number" id="payAmount" placeholder="Amount (‚Çπ)" style="width:100%; padding:10px; margin-bottom:10px;">
        
        <select id="payMethod" style="width:100%; padding:10px; margin-bottom:10px;">
            <option value="Cash">Cash</option>
            <option value="UPI">UPI / Online</option>
            <option value="Cheque">Cheque</option>
        </select>

        <div style="display:flex; gap:10px;">
            <button onclick="document.getElementById('paymentModal').style.display='none'" style="flex:1; padding:10px; border:none; background:#ccc;">Cancel</button>
            <button onclick="submitPayment()" style="flex:1; padding:10px; border:none; background:#28a745; color:white;">Submit</button>
        </div>
    </div>
</div>


        </div>

      </div>
    </div>

  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script type="module" src="js/salesman.js"></script>

</body>
</html>
